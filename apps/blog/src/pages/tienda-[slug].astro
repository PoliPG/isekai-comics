---
import { GroupNotFound } from '@/Isekai/Group/Domain/errors/GroupNotFound'
import { ContainerDI } from '@/Isekai/Shared/Container/ContainerDI'
import types from '@/Isekai/Shared/Container/types'
import BaseLayout from '@/layouts/BaseLayout'
import type { MessageBus } from 'message-bus'
import {GetCollectionViewCommand} from '@/Isekai/Group/Application/get-collection-view/GetCollectionViewCommand'
import {GetCollectionViewDTO} from '@/Isekai/Group/Application/get-collection-view/DTO/GetCollectionViewDTO'

export const prerender = false // server
const {slug} = Astro.params
let groupView!: GetCollectionViewDTO

if(!slug) {
  return new Response(null, {
    status: 404,
    statusText: 'Collection not found'
  });
}

try {
  const container = ContainerDI.getInstance()
  const command = new GetCollectionViewCommand(slug)
  const commandBus = container.get<MessageBus>(types.CommandBus)
  groupView = await commandBus.commit(command)
}
catch(error) {
  console.log(error)
  if(error instanceof GroupNotFound)
	return new Response(null, {
		status: 404,
		statusText: 'No encontrado'
	});

  return new Response(null, {status: 500, statusText: "Hubo un error en el servidor."})
}
---
<BaseLayout
	title={groupView.metaTitle}
	description={groupView.metaDescription}
>
  <div>Holaa {groupView.name} </div>
</BaseLayout>